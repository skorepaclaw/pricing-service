name: Test

on:
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest httpx
      
      - name: Run health check test
        run: |
          python -c "
          import asyncio
          from main import app
          from fastapi.testclient import TestClient
          
          client = TestClient(app)
          
          # Test home page loads
          response = client.get('/')
          assert response.status_code == 200
          assert 'ŠKODA' in response.text
          
          # Test health endpoint
          response = client.get('/health')
          assert response.status_code == 200
          data = response.json()
          assert 'status' in data
          
          # Test calculate endpoint
          response = client.post('/api/calculate', json={'model': 'fabia', 'extras': []})
          assert response.status_code == 200
          assert response.json()['total'] == 419900
          
          print('✅ All tests passed!')
          "
